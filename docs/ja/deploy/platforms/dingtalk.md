# DingTalk ボットのデプロイ

DingTalk に LangBot をデプロイします。

## ボットの作成

[DingTalk 開発者バックエンド](https://open-dev.dingtalk.com/?spm=ding_open_doc.document.0.0.74f445e5MkawbT#/)にアクセスし、ログインして組織に入ります。ログインに成功したら、オープンプラットフォームに入ります。以下のように表示されます：
![DingTalk Open Platform](/assets/image/zh/deploy/bots/dingtalk/dingtalk1.png)

上部の「アプリケーション開発」をクリックし、右側の青いボタン「アプリケーションを作成」をクリックして、ボットの基本情報を入力し、保存をクリックします。

ボットのバックエンドに入ります。例えば、langbot2 という名前のボットがある場合、管理ページは以下のように表示されます：
![Bot Page](/assets/image/zh/deploy/bots/dingtalk/dingtalk2.png)

## ボットの設定

「アプリケーション機能を追加」、「その他のアプリケーション機能」、「ロボット」の「設定」をクリックし、設定をクリックして情報を入力します。以下のように：
![Bot Configuration](/assets/image/zh/deploy/bots/dingtalk/dingtalk3.png)

ページ下部の「公開」をクリックし、公開が成功したら、ボットページの左下にある「バージョン管理と公開」をクリックします。以下のように：
![Version Management and Publishing](/assets/image/zh/deploy/bots/dingtalk/dingtalk4.png)

初めてボットを作成する場合、右側は空なので、「新しいバージョンを作成」をクリックし、その中で情報を設定し、「アプリケーションの表示範囲」を設定して、保存をクリックします。

「イベントサブスクリプション」をクリックし、プッシュ方式を「ストリームモードプッシュ」に変更します。

カードストリーミングが必要な場合は、権限管理でカード権限を申請する必要があります。以下のように：
![Before applying for card permissions](/assets/image/zh/deploy/bots/dingtalk/dingtalk6.png)

![After applying for card permissions](/assets/image/zh/deploy/bots/dingtalk/dingtalk7.png)

さらに、カードメッセージの場合、主にカードテンプレートを作成し、テンプレート ID を記録して設定に入力する必要があります。手順は以下の通りです：
> カードコンテンツテンプレート ID は、開発者バックエンドにログイン > [カードプラットフォーム](https://open-dev.dingtalk.com/fe/card?spm=ding_open_doc.document.0.0.33cf2281L0fXsV)から取得できます

新しいテンプレートを作成する際に情報を入力します。以下のように：
![Fill in information for new template](/assets/image/zh/deploy/bots/dingtalk/dingtalk8.png)

プリセットテンプレートを選択します（最初のものを選択し、後でテンプレートの内容を変更します）。以下のように：
![Select preset template](/assets/image/zh/deploy/bots/dingtalk/dingtalk9.png)
使用をクリック
![Click](/assets/image/zh/deploy/bots/dingtalk/dingtalk10.png)
作成
![Create](/assets/image/zh/deploy/bots/dingtalk/dingtalk11.png)

作成をクリックすると、テンプレートの編集にリダイレクトされます。以下のように、希望するカードメッセージを自由に編集できます：
![Edit template](/assets/image/zh/deploy/bots/dingtalk/dingtalk12.png)

メインコンテンツについては、デフォルトの「content」をそのままにしておきます：
![Don't modify](../../../assets/image/zh/deploy/bots/dingtalk/dingtalk13.png)

編集を終え、すべて正しいことを確認したら、保存してテンプレート ID をコピーし、設定ファイルに入力します：
![Save](../../../assets/image/zh/deploy/bots/dingtalk/dingtalk14.png)
![Copy template ID](../../../assets/image/zh/deploy/bots/dingtalk/dingtalk15.png)

## 設定情報の入力

「認証情報と基本情報」をクリックし、「Client ID」と「Client Secret」を記録します。
「アプリケーション機能」、「ロボット」をクリックし、RobotCode とロボット名を記録します。
`markdown_card` は Markdown 形式の返信を有効にするかどうかです。
上記の設定項目を記録し、LangBot ボット設定フォームに入力します

[カードプラットフォーム](https://open-dev.dingtalk.com/fe/card?spm=ding_open_doc.document.0.0.33cf2281L0fXsV)をクリックし、テンプレートリストから対応するバインドされたテンプレート ID をコピーし、カードテンプレート ID フィールドに入力します。

![Connect to LangBot](/assets/image/zh/deploy/bots/dingtalk/connect_to_langbot.png)

ストリーミング関連：
![img.png](../../../assets/image/zh/deploy/bots/lark/lark_15.png)

**LangBot を起動します**。

## ボットの追加

この記事では DingTalk Windows デスクトップ版を例として使用します。上部の「検索」、「機能」をクリックし、先ほど作成したボットの名前を入力します。以下のように：
![robot_png](/assets/image/zh/deploy/bots/dingtalk/dingtalk5.png)

ボットをクリックしてチャットします。

グループに追加したい場合は、DingTalk グループの「グループ管理」、「ロボット」、「ロボットを追加」をクリックし、ボット名を検索してグループで使用します。
